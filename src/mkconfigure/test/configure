#!/bin/sh
################################################################################
# This script was generated with the following command:
#  mkconfigure -name my_app -ver 1.0.0 -build-h -iflib -lX11 -lXt X11/Xlib.h X11/X.h X11/Intrinsic.h -cstr 'Widget *w = NULL;' -def __linux__ __unix__ __GNUC__=4 '#ifdef __linux__ && defined __unix__' -type Widget int32_t -func XtCreateWidget fprintf atoi -rval __GNUC__ __linux__ $SRCROOT/test.c '#if (__GNUC__ == 4 && __GNUC_MINOR__ == 7) || __SIZEOF_LONG_LONG__ == 8' -cc -c++ -lib -params=-ldflags -modules -debug -enable-ui -ui-type -xflags -xparam -xxparam -iftool grep ar tclsh -sh test -f /etc/debian_version && echo "CONFIG_DEBIAN=1" >> build.conf -iflib -short -lXm Xm/Xm.h Xm/PushB.h -func XmCreatePushButton -var xmPushButtonWidgetClass -sym xmTextFieldWidgetClass -rval XmSET -enum XmSET XmTOGGLEBUTTON -iflib -lgif gif_lib.h -iflib -cxx -lQtGui -inc QtGui/QtGui
#
# Important variables to use:
#   PACKAGE_NAME     - name of package
#   PACKAGE_VERSION  - package version
#   CONF             - name of the build config file
#   CONF_H           - name of the build config header file
#   CUSTOM_OPTIONS   - custom configure options
#   TOOLS            - tools used in this package
#   SRCROOT          - package source root directory (package top dir)
#   BUILDROOT        - path to the build root directory (current dir)

################################################################################
# BASE CONFIGURATION
PACKAGE_NAME="my_app"
PACKAGE_VERSION="1.0.0"
CONF="build.conf"
CONF_H="build.h"
CUSTOM_OPTIONS="-ldflags -modules -debug -enable-ui -ui-type -xflags -xparam -xxparam"
TOOLS="rcrq mkbuildroot relpath mkrule pofig libro iflib cstem cstem+ mkdep install ar"

################################################################################
# INIT
SRCROOT=`dirname $0`
BUILDROOT=`pwd`
PATH=$FORMAKE:$BUILDROOT/formake:$SRCROOT/formake:$PATH

################################################################################
# OPTIONS
std_options=`rcrq -install-options -c-options -cxx-options` || exit 1
optool validate "$@" - -h -help --help $std_options $CUSTOM_OPTIONS || exit 1
if optool ifor "$@" - -h -help --help; then
  confighelp -install -cc -cxx || exit 1
  cat <<EOF
  -ldflags
  -modules
  -debug
  -enable-ui
  -ui-type
  -xflags
  -xparam
  -xxparam
EOF
  exit 0
fi
optool dump "$@" >$CONF
. $CONF

################################################################################
# DEPENDENCY TOOLS
iftool $TOOLS || exit 1
iftool grep ar tclsh || exit 1

################################################################################
# INIT BUILDROOT
mkbuildroot $SRCROOT $BUILDROOT || exit 1
rm -f configure.log

################################################################################
# CONFIGURE FORMAKE
optool dump "$@ -package-name $PACKAGE_NAME -package-version $PACKAGE_VERSION" >formake/config.rc

################################################################################
# PROBE AND CONFIGURE COMPILERS
cstem config -cc $CC -cflags="$CFLAGS"
cstem+ config -cc $CXX -cflags="$CXXFLAGS"

################################################################################
# DEPENDENCY LIBRARIES
iflib -cc -lX11 -lXt X11/Xlib.h X11/X.h X11/Intrinsic.h -cstr 'Widget *w = NULL;' -def __linux__ __unix__ __GNUC__=4 '#ifdef __linux__ && defined __unix__' -type Widget int32_t -func XtCreateWidget fprintf atoi -rval __GNUC__ __linux__ $SRCROOT/test.c '#if (__GNUC__ == 4 && __GNUC_MINOR__ == 7) || __SIZEOF_LONG_LONG__ == 8' -log configure.log || exit 1
iflib -cc -short -lXm Xm/Xm.h Xm/PushB.h -func XmCreatePushButton -var xmPushButtonWidgetClass -sym xmTextFieldWidgetClass -rval XmSET -enum XmSET XmTOGGLEBUTTON -log configure.log || exit 1
iflib -cc -lgif gif_lib.h -log configure.log || exit 1
iflib -cc -cxx -lQtGui -inc QtGui/QtGui -log configure.log || exit 1

################################################################################
# CUSTOM CODE
# put your custom code here
test -f /etc/debian_version && echo "CONFIG_DEBIAN=1" >> build.conf

################################################################################
# CONFIG FILES
optool dump -package-name $PACKAGE_NAME -package-version $PACKAGE_VERSION >>$CONF
optool hdump "$@" -package-name "$PACKAGE_NAME" -package-version $PACKAGE_VERSION >$CONF_H

################################################################################
# MKMF
cd $BUILDROOT
$SRCROOT/mkmf || exit 1

################################################################################
# FINISH
echo "configuring done."

