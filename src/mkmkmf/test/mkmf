#!/bin/sh
################################################################################
# This script was generated with the following command:
#  mkmkmf -app1-src file1.c file2.c app1.c common.c net.c db.c -app1-name app1 -lib1-src common.c net.c www.c tty.c ghf.c rx.c -lib1-name fxx -lib1-ldflags=-lX11 -lXt -lXm -lib1-ver 1.0.1 -inst-bin script1 -inst-lib libvga.a -inst-inc common.h vga.h fxx.h ui.h tty.h con.h -subdirs mod1 mod2 tests libeee libeee2
#
#
# Important variables to use:
#   SUBSCRIPT        - path to a subscript - script with custom subroutines
#   SRCROOT          - package source root directory (package top dir)
#   BUILDROOT        - VPATH build root (package build root dir)
#   SRCDIR           - absolute path to a source directory where mkmf is located
#   SRCDIR_REL       - relative path from SRCROOT to SRCDIR
#   SRCROOT_REL      - relative path from SRCDIR to SRCROOT
#   BUILDDIR         - VPATH build dir (output dir for placing all files generated by mkmf or $MAKEFILE)
#   BUILDCONF        - path to a package build config file
#   PKGBIN           - path to a package script directory
#   SUBDIRS          - subdirectories with mkmf scripts

################################################################################
# BASE CONFIGURATION
SRCROOT=.
BUILD_CONF="build.conf"
MAKEFILE="Makefile"
SUBDIRS="mod1 mod2 tests libeee libeee2"
FORMAKE_TOOLS="abspath relpath listed cstem libro mkrule"

################################################################################
# INIT
SCRIPT_NAME=`basename $0`
cd `dirname $0`
ABS_SRCDIR=`pwd`
PATH=$PATH:$ABS_SRCDIR/$SRCROOT/formake
iftool -f $FORMAKE_TOOLS || exit 1
ABS_SRCROOT=`abspath -b $ABS_SRCDIR $SRCROOT`
ABS_BUILDROOT=$ABS_SRCROOT
test -n "$BUILDROOT" && ABS_BUILDROOT=`abspath $BUILDROOT`
PATH="$ABS_BUILDROOT/formake:$PATH"
SRCSUBDIR=`relpath $ABS_SRCROOT $ABS_SRCDIR`
ABS_BUILDDIR=$ABS_BUILDROOT/$SRCSUBDIR
mkdir -p $ABS_BUILDDIR || exit 1
cd $ABS_BUILDDIR
BUILDDIR=.
BUILDROOT=`relpath ./ $ABS_BUILDROOT`
SRCROOT=`relpath ./ $ABS_SRCROOT`
SRCDIR=`relpath ./ $ABS_SRCDIR`

################################################################################
# READ CONFIG
#. $BUILDROOT/$BUILD_CONF

################################################################################
# INIT MAKEFILE
mkrule all >$MAKEFILE

################################################################################
# OBJECTS
CFLAGS=""
STATIC_DIR="_static"
PIC_DIR="_pic"
app1_sources="file1.c file2.c app1.c common.c net.c db.c"
lib1_sources="common.c net.c www.c tty.c ghf.c rx.c"

static_sources=`listed -pref=$SRCDIR/ $app1_sources $lib1_sources`
pic_sources=`listed -pref=$SRCDIR/ $lib1_sources`
mkrule obj -cflags="$CFLAGS" -src $static_sources -d $STATIC_DIR >>$MAKEFILE
mkrule obj -pic -cflags="$CFLAGS" -src $pic_sources -d $PIC_DIR >>$MAKEFILE

################################################################################
# APPLICATIONS
app1_name="app1"
app1_ldflags=""
app1_obj=`listed -pref=$STATIC_DIR/ -ext=o $app1_sources`
mkrule app -all -install -ldflags="$app1_ldflags" -n $app1_name -obj $app1_obj >>$MAKEFILE

################################################################################
# LIBRARIES
lib1_name="fxx"
lib1_version="1.0.1"
lib1_ldflags="-lX11 -lXt -lXm"
lib1_static_obj=`listed -pref=$STATIC_DIR/ -ext=o $lib1_sources`
lib1_pic_obj=`listed -pref=$PIC_DIR/ -ext=o $lib1_sources`
mkrule lib -all -install -static -ldflags="$lib1_ldflags" -n $lib1_name -ver $lib1_version -obj $lib1_static_obj >>$MAKEFILE
mkrule lib -all -install -shared -ldflags="$lib1_ldflags" -n $lib1_name -ver $lib1_version -obj $lib1_pic_obj >>$MAKEFILE

################################################################################
# INSTALLATION FILES
install_bin=`listed -pref=$SRCDIR/ script1`
install_lib=`listed -pref=$SRCDIR/ libvga.a`
install_inc=`listed -pref=$SRCDIR/ common.h vga.h fxx.h ui.h tty.h con.h`
mkrule install bin $install_bin >>$MAKEFILE
mkrule install lib $install_lib >>$MAKEFILE
mkrule install inc $install_inc >>$MAKEFILE

################################################################################
# SUBDIRS
mkrule subdir -all -install -clean -distclean -d $SUBDIRS >>$MAKEFILE
#for dir in $SUBDIRS; do
#  BUILDROOT=$ABS_BUILDROOT $ABS_SRCDIR/$dir/mkmf
#done

################################################################################
# DONE
printf "%s\n" "$SRCSUBDIR/$SCRIPT_NAME: DONE"

