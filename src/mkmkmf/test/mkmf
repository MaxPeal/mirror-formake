#!/bin/sh
################################################################################
# This script was generated with the following command:
#  mkmkmf -prog1-src file1.c file2.c app1.c common.c net.c db.c -prog1-name app1 -lib1-src common.c net.c www.c tty.c ghf.c rx.c -lib1-name fxx -lib1-ldflags=-lX11 -lXt -lXm -lib1-ver 1.0.1 -inst-bin script1 -inst-lib libvga.a -inst-inc common.h vga.h fxx.h ui.h tty.h con.h -subdirs mod1 mod2 tests libeee libeee2
#
#
# Important variables to use:
#   BUILDROOT        - relative path to the build root directory
#   CONF             - name of the build config file
#   MAKEFILE         - name of output Make file
#   TOOLS            - tools used in this script
#   SUBDIRS          - subdirectories to run mkmf in
#   SCRIPT           - name of this script
#   SRCDIR           - relative path to the source directory (mkmf location)
#   SRCROOT          - relative path to the source root directory (package top dir)
#   ASB_BUILDDIR     - absolute path to the build directory (current dir)
#   SUBDIR           - current directory path from BUILDROOT

################################################################################
# BASE CONFIGURATION
export BUILDROOT=.
CONF="build.conf"
MAKEFILE="Makefile"
TOOLS="relpath mkrule"
SUBDIRS="mod1 mod2 tests libeee libeee2"

################################################################################
# INIT
SCRIPT=`basename $0`
PATH=$FORMAKE:$PWD/$BUILDROOT/formake:$PATH
iftool -f $TOOLS || exit 1
export SRCDIR=`dirname $0 | xargs relpath ./`
SRCROOT=`relpath ./ $SRCDIR/$BUILDROOT`
ABS_BUILDDIR=`pwd`
SUBDIR=`relpath $BUILDROOT ./`

################################################################################
# READ CONFIG
#. $BUILDROOT/$CONF

################################################################################
# INIT MAKEFILE
mkrule init >$MAKEFILE
mkrule distclean $MAKEFILE >>$MAKEFILE

################################################################################
# OBJECTS
CFLAGS=""
STATIC_DIR="_static"
PIC_DIR="_pic"
prog1_sources="file1.c file2.c app1.c common.c net.c db.c"
lib1_sources="common.c net.c www.c tty.c ghf.c rx.c"
mkrule obj -cflags="$CFLAGS" -src $prog1_sources $lib1_sources -d $STATIC_DIR >>$MAKEFILE
mkrule obj -pic -cflags="$CFLAGS" -src $lib1_sources -d $PIC_DIR >>$MAKEFILE

################################################################################
# APPLICATIONS
prog1_name="app1"
prog1_ldflags=""
mkrule prog -all -install -ldflags="$prog1_ldflags" -n $prog1_name -objdir $STATIC_DIR -sobj $prog1_sources >>$MAKEFILE

################################################################################
# LIBRARIES
lib1_name="fxx"
lib1_version="1.0.1"
lib1_ldflags="-lX11 -lXt -lXm"
mkrule lib -all -install -static -ldflags="$lib1_ldflags" -n $lib1_name -ver $lib1_version -objdir $STATIC_DIR -sobj $lib1_sources >>$MAKEFILE
mkrule lib -all -install -shared -ldflags="$lib1_ldflags" -n $lib1_name -ver $lib1_version -objdir $PIC_DIR -sobj $lib1_sources >>$MAKEFILE

################################################################################
# CUSTOM CODE
# put your custom code here

################################################################################
# INSTALLATION FILES
install_bin="script1"
install_lib="libvga.a"
install_inc="common.h vga.h fxx.h ui.h tty.h con.h"
mkrule install bin $install_bin >>$MAKEFILE
mkrule install lib $install_lib >>$MAKEFILE
mkrule install inc $install_inc >>$MAKEFILE

################################################################################
# DIST
dist_files="configure formake/relpath formake/mkrule formake/abspath formake/cstem formake/cstem+ formake/iflib formake/iftool formake/libro formake/mkbuildroot formake/mkdep formake/optool formake/pofig mkmf $install_bin $install_lib $install_inc $lib1_sources $prog1_sources"
mkrule dist -n $PACKAGE_NAME -ver $PACKAGE_VERSION -f $dist_files >>$MAKEFILE || exit 1

################################################################################
# SUBDIRS
mkrule subdir -all -install -clean -dist -distclean -d $SUBDIRS >>$MAKEFILE
cd $ABS_BUILDDIR
for dir in $SUBDIRS; do
  test -d $dir || mkdir -p $dir
  `cd $dir; $ABS_BUILDDIR/$SRCDIR/$dir/mkmf` || exit 1
done

################################################################################
# DONE
echo "$SUBDIR/$SCRIPT: DONE"

