#!/bin/sh
################################################################################
# This script was generated with the following command:
#  mkmkmf -srcroot ./ -subdirs src/
#
#
# Important variables to use:
#   SUBSCRIPT        - path to a subscript - script with custom subroutines
#   SRCROOT          - package source root directory (package top dir)
#   BUILDROOT        - VPATH build root (package build root dir)
#   SRCDIR           - absolute path to a source directory where mkmf is located
#   SRCDIR_REL       - relative path from SRCROOT to SRCDIR
#   SRCROOT_REL      - relative path from SRCDIR to SRCROOT
#   BUILDDIR         - VPATH build dir (output dir for placing all files generated by mkmf or $MAKEFILE)
#   BUILDCONF        - path to a package build config file
#   PKGBIN           - path to a package script directory
#   SUBDIRS          - subdirectories with mkmf scripts

################################################################################
# BASE CONFIGURATION
SRCROOT=.
BUILD_CONF="build.conf"
MAKEFILE="Makefile"
SUBDIRS="src"
FORMAKE_TOOLS="abspath relpath mkrule"

################################################################################
# INIT
SCRIPT_NAME=`basename $0`
cd `dirname $0`
ABS_SRCDIR=`pwd`
PATH=$PATH:$ABS_SRCDIR/$SRCROOT/formake
iftool -f $FORMAKE_TOOLS || exit 1
ABS_SRCROOT=`abspath -b $ABS_SRCDIR $SRCROOT`
ABS_BUILDROOT=$ABS_SRCROOT
test -n "$BUILDROOT" && ABS_BUILDROOT=`abspath $BUILDROOT`
PATH="$ABS_BUILDROOT/formake:$PATH"
SRCSUBDIR=`relpath $ABS_SRCROOT $ABS_SRCDIR`
ABS_BUILDDIR=$ABS_BUILDROOT/$SRCSUBDIR
mkdir -p $ABS_BUILDDIR || exit 1
cd $ABS_BUILDDIR
BUILDDIR=.
BUILDROOT=`relpath ./ $ABS_BUILDROOT`
SRCROOT=`relpath ./ $ABS_SRCROOT`
SRCDIR=`relpath ./ $ABS_SRCDIR`

################################################################################
# READ CONFIG
#. $BUILDROOT/$BUILD_CONF

################################################################################
# INIT MAKEFILE
mkrule all >$MAKEFILE
mkrule distclean $MAKEFILE formake/'*.conf' >>$MAKEFILE

################################################################################
# SUBDIRS
mkrule subdir -all -install -clean -distclean -d $SUBDIRS >>$MAKEFILE
for dir in $SUBDIRS; do
  BUILDROOT=$ABS_BUILDROOT $ABS_SRCDIR/$dir/mkmf || exit 1
done

################################################################################
# DONE
printf "%s\n" "$SRCSUBDIR/$SCRIPT_NAME: DONE"

