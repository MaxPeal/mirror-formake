#!/bin/sh
################################################################################
# Generated by Formake mkmkmf
# Wed Feb 15 17:07:12 EET 2017
# mkmkmf -srcroot . -subdirs src

################################################################################
# BASE CONFIGURATION
BUILDROOT=.
CONF="build.conf"
MAKEFILE="Makefile"
TOOLS="relpath mkrule"
SUBDIRS="src"

################################################################################
# INIT
SCRIPT=`basename $0`
PATH=$FORMAKE:$PWD/$BUILDROOT/formake:$PATH
syscap test -f $TOOLS || exit 1
SRCDIR=`dirname $0 | xargs relpath ./`
SRCROOT=`relpath ./ $SRCDIR/$BUILDROOT`
ABS_BUILDDIR=`pwd`
SUBDIR=`relpath $BUILDROOT ./`

################################################################################
# READ CONFIG
. $BUILDROOT/$CONF

################################################################################
# INIT MAKEFILE
mkrule init >$MAKEFILE
mkrule distclean $MAKEFILE $CONF formake/'*.conf' >>$MAKEFILE

################################################################################
# CUSTOM CODE

################################################################################
# DIST
dist_files="configure formake/relpath formake/mkrule formake/optool formake/syscap mkmf "
mkrule dist -n $PACKAGE_NAME -ver $PACKAGE_VERSION -buildroot $BUILDROOT -srcdir $SRCDIR -f $dist_files >>$MAKEFILE || exit 1

################################################################################
# SUBDIRS
mkrule subdir -all -install -clean -dist -distclean -d $SUBDIRS >>$MAKEFILE
for dir in $SUBDIRS; do
  cd $ABS_BUILDDIR
  test -d $dir || mkdir -p $dir
  cd $dir; $ABS_BUILDDIR/$SRCDIR/$dir/mkmf || exit 1
done

################################################################################
# DONE
echo "$SUBDIR/$SCRIPT: DONE"

